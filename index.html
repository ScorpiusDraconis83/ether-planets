<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/p5"></script>
</head>
<style>
    body {
        background-color: black;
    }
</style>

<body>
    <script>
        let angle = 0;
        let textureImg;
        let stars = [];
        let planetSize;
        let glowSize;

        function setup() {
            createCanvas(400, 400, WEBGL);
            let numColors = 5;
            let randomPalette = [];
            for (let i = 0; i < numColors; i++) {
                randomPalette.push(color(random(255), random(255), random(255)));
            }
            let thresholds = [];
            for (let i = 0; i < numColors - 1; i++) {
                thresholds.push(random());
            }
            thresholds.sort();
            let randomColorPalette = {
                thresholds: thresholds,
                colors: randomPalette
            };
            textureImg = generateTexture(randomColorPalette.thresholds, randomColorPalette.colors);

            // Generate stars
            for (let i = 0; i < 1000; i++) {
                stars.push({
                    x: random(-width * 5, width * 5),
                    y: random(-height * 5, height * 5),
                    z: random(width * 5),
                    radius: random(0.5, 2),
                });
            }

            planetSize = random(50, 250);
            glowSize = planetSize + random(10, 40)
        }

        function generateTexture(elevationThresholds, colors) {
            let textureImg = createGraphics(1024, 512);
            textureImg.noiseSeed(random(1000));
            for (let x = 0; x < textureImg.width; x++) {
                for (let y = 0; y < textureImg.height; y++) {
                    let elevation = textureImg.noise(x * 0.01, y * 0.01);
                    let col = color(0);
                    for (let i = 0; i < elevationThresholds.length; i++) {
                        if (elevation < elevationThresholds[i]) {
                            col = lerpColor(colors[i], colors[i + 1], (elevation - (i === 0 ? 0 : elevationThresholds[i - 1])) * (1 / (elevationThresholds[i] - (i === 0 ? 0 : elevationThresholds[i - 1]))));
                            break;
                        }
                    }
                    textureImg.set(x, y, col);
                }
            }
            textureImg.updatePixels();
            return textureImg;
        }


        function draw() {
            background(0);

            // Draw stars
            push();
            translate(0, 0, -1200);
            for (let star of stars) {
                stroke(255);
                strokeWeight(star.radius);
                point(star.x, star.y, star.z);
            }
            pop();

            // Set up ambient light
            ambientLight(100);
            ambientMaterial(0);

            // Set up point light
            pointLight(255, 255, 255, -400, -200, 1200);

            // Set up camera
            let fixedDistance = 450;
            let camX = fixedDistance * sin(atan2(mouseY - height / 2, mouseX - width / 2));
            let camY = fixedDistance * cos(atan2(mouseY - height / 2, mouseX - width / 2));
            let camZ = fixedDistance;
            camera(camX, camY, camZ, 0, 0, 0, 0, 1, 0);

            // Rotate planet
            rotateY(angle);
            angle += 0.005;

            // Draw planet
            texture(textureImg);
            noStroke();
            sphere(planetSize);

            // Simple glow effect
            let numGlowLayers = 5;
            let glowColor = color(255, 100, 80, 10);
            for (let i = 1; i <= numGlowLayers; i++) {
                fill(glowColor);
                sphere(glowSize + i * 2);
            }
        }

    </script>
</body>

</html>